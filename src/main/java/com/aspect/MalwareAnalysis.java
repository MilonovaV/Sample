package com.aspect;

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.util.Random;

public class MalwareAnalysis {

    // Method to analyze the malware sample
    public void analyzeSample(Sample sample) {
        try {
            // Simulate a delay for the analysis
            int delay = new Random().nextInt(2000) + 1000;  
            Thread.sleep(delay);
        } catch (InterruptedException e) {
            System.out.println("Analysis interrupted.");
        }

        // Simulate analyzing the sample
        System.out.println("Analyzing sample: " + sample.getFilename());

        // Generate an AnalysisResult
        String resultId = "result_" + new Random().nextInt(1000);  // Random ID for the result
        String sampleId = sample.getFilename();
        String categorization = sample.getCategory();
        String modelOutput = "Detected as malicious";  // Example output from the model

        // Count the number of lines in the sample
        int numLines = countLinesInSample(sample.getFilename());

        // Create the AnalysisResult object
        AnalysisResult analysisResult = new AnalysisResult(resultId, sampleId, categorization, modelOutput);

        // Save the result to a log file
        analysisResult.generateReport();

        // Display the number of lines as part of the analysis
        System.out.println("Number of lines in sample: " + numLines);
    }

    // Method to count the number of lines in the sample file
    private int countLinesInSample(String sampleFilename) {
        int lines = 0;
        try (BufferedReader reader = new BufferedReader(new FileReader(sampleFilename))) {
            while (reader.readLine() != null) {
                lines++;
            }
        } catch (IOException e) {
            System.out.println("Error reading sample file: " + e.getMessage());
        }
        return lines;
    }
}
