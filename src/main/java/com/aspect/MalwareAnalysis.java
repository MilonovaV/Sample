package com.aspect;

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.util.Random;

public class MalwareAnalysis {

    Random random;

    private void init(){
        this.random = new Random();
    }

    public void analyzeSample(Sample sample) throws IOException, InterruptedException {

        int delay = this.random.nextInt(2000) + 1000;  
        Thread.sleep(delay);


        String resultId = "result_" + this.random.nextInt(1000); 
        String sampleId = sample.getFilename();
        String categorization = sample.getCategory();
        String modelOutput = "Detected as malicious";  

        int numLines = countLinesInSample(sample.getFilename());

        AnalysisResult analysisResult = new AnalysisResult(resultId, sampleId, categorization, modelOutput, numLines);

        analysisResult.generateReport();
    }

    private int countLinesInSample(String sampleFilename) throws IOException {
        int lines = 0;
        BufferedReader reader = new BufferedReader(new FileReader(sampleFilename));
        while (reader.readLine() != null) {
            lines++;
        }
        return lines;
    }
}
